# generated by chef

#
# DHCP Server Configuration file.
#   see /usr/share/doc/dhcp*/dhcpd.conf.sample
#   see 'man 5 dhcpd.conf'
#

authoritative;
allow booting;
allow bootp;
option domain-name              "<%= @properties['domain'] %>";
option domain-name-servers      <%= @properties['dns'] %>;
option time-offset              <%= @properties['tz'] %>;
option ntp-servers              <%= @properties['ntp'] %>;
option subnet-mask              <%= @properties['netmask'] %>;
filename "pxelinux.0";

# pxe에 여러 NIC을 물리고, 해당 네트워크에 맞게 설정을 해준다.
# - subnet
# - range
# - router(gateway)
# - next-server
#
#
# host-name으로 정한 것을 클라이언트에서 받는 방법:
#  간단하군 /usr/share/doc/dhcp-XXX/sethostname.sh 파일을 클라이언트에 /etc/dhclient-enter-hooks으로 넣어주면 되는군요.
#
# TODO:
#  host-name을 다이나믹하게 정하는 방법이 없을까? 아니 그냥 chef가 나을지도..

<% @subnets.each do |subnet| -%>

#  <%= subnet['description'] %>
subnet <%= subnet['network'] %> netmask <%= subnet['netmask'] %> {
<% if subnet['gateway'] then -%>
        option routers <%= subnet['gateway'] %>;
<% end -%>
        range <%= subnet['range'] %>;
<% if subnet['next-server'] then -%>
        next-server <%= subnet['next-server'] %>;
<% end -%>
        option host-name "<%= subnet["id"] %>-host";
                
        <% subnet['hosts'].each do |host| -%>
        host <%= host["hostname"] %> {
                hardware ethernet <%= host["mac"] %>;
                fixed-address <%= host["ip"] %>;
                option host-name <%= host["hostname"] %>;
        }
        <% end %>
}
<% end %>
<%
# vim: ai ts=4 sw=4 expandtab
%>
